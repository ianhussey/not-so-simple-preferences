---
title: "(Not so) simple preferences"
subtitle: "Analysis"
author: "Ian Hussey"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

# TODO

NA

```{r include=FALSE}

knitr::opts_chunk$set(message = FALSE, 
                      warning = FALSE)

options(scipen=999)

```

# Dependencies

```{r}

library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(forcats)
library(effectsize)
library(psych)
library(knitr)
library(kableExtra)
library(janitor)
library(lavaan)
library(tibble)
library(purrr)
library(ggstance)

```

# Load data

```{r}

data_predictions <- read_csv("../../data/raw/data_predictions.csv")

data_processed <- read_rds("../../data/processed/data_processed.rds") |>
  rename(love = other_evaluations_love,
         murder = other_evaluations_murder,
         vacation = other_evaluations_vacation,
         racist = other_evaluations_racist,
         pedophile = other_evaluations_pedophile,
         shrewd = other_evaluations_shrewd,
         honest = other_evaluations_honest,
         dishonest = other_evaluations_dishonest,
         mcdonalds = other_evaluations_mcdonalds,
         burgerking = other_evaluations_burgerking,
         conservatives = other_evaluations_conservatives,
         liberals = other_evaluations_liberals,
         girls_skirts = other_beliefs_girls_skirts,
         boys_skirts = other_beliefs_boys_skirts,
         cats_legs = other_beliefs_cats_legs,
         fish_legs = other_beliefs_fish_legs)

```

# Exclusions

```{r}

data_processed |>
  count(attention_check1, 
        attention_check2,
        attention_check3,
        self_exclude,
        bot_check, 
        age_check,
        completeness_check,
        completion_time_check) |>
  arrange(desc(n))

data_exclusions <- data_processed |>
  filter(global_check == "passed") 

ggplot(data_exclusions, aes(completion_time/60)) +
  geom_histogram(binwidth = 1, boundary = 0) +
  xlab("minutes") +
  scale_x_continuous(breaks = scales::breaks_pretty(n = 15), limits = c(0, NA)) +
  geom_vline(xintercept = 2, linetype = "dashed", color = "red") +
  ggtitle("Study completion time in non-excluded participants")

```

# Demographics

```{r}

data_processed |>
  count(global_check) |>
  mutate(percent = n/sum(n)*100) |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

data_exclusions |>
  summarize(n = n(),
            mean_age = mean(age),
            sd_age = sd(age)) |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

data_exclusions |>
  count(gender) |>
  mutate(percent = n/sum(n)*100) |>
  mutate_if(is.numeric, round_half_up, digits = 1) |>
  kable() |>
  kable_classic(full_width = FALSE)

data_exclusions |>
  count(ethnicity) |>
  mutate(percent = n/sum(n)*100) |>
  mutate_if(is.numeric, round_half_up, digits = 1) |>
  kable() |>
  kable_classic(full_width = FALSE)

data_exclusions |>
  count(country) |>
  mutate(percent = n/sum(n)*100) |>
  mutate_if(is.numeric, round_half_up, digits = 1) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

# Poop / chocolate

## Distributions

```{r}

data_exclusions_reshaped <- data_exclusions |>
  select(participant_id, 
         desirability_chocolate, 
         desirability_poop,
         classic_chocolate,
         classic_poop,
         original_chocolate,
         original_poop) |>
  pivot_longer(cols = -participant_id,
               names_to = c("scale", "stimulus"),
               names_sep = "_",
               values_to = "response") 

ggplot(data_exclusions_reshaped, aes(response)) +
  geom_histogram(boundary = 0.5, binwidth = 1) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7) +
  theme_linedraw() +
  facet_grid(scale ~ stimulus)

data_exclusions_reshaped |>
  group_by(scale, stimulus) |>
  summarize(mean = mean(response),
            sd = sd(response)) |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

## Structural validity

```{r}

cfa_constrained <- function(
    dat, 
    items,
    ordered = FALSE,
    std_lv = TRUE,
    enforce_tau_eq = TRUE,
    thresholds = list(min_std_loading = 0.40, min_r2 = 0.20)
){
  stopifnot(all(items %in% names(dat)))
  if (length(items) < 3) stop("Need ≥ 3 items.")
  
  # --- Model syntax
  load_part <- if (enforce_tau_eq) paste(paste0("a*", items), collapse = " + ")
  else                 paste(items, collapse = " + ")
  mod <- paste0("F =~ ", load_part)
  
  # --- Estimation
  estimator   <- if (ordered) "WLSMV" else "MLR"
  miss        <- if (ordered) "listwise" else "fiml"
  ordered_vec <- if (ordered) items else NULL
  
  fit <- lavaan::cfa(
    model = mod,
    data = dat,
    std.lv = std_lv,
    meanstructure = TRUE,
    estimator = estimator,
    missing = miss,
    ordered = ordered_vec
  )
  
  # --- Global fit indices
  fm <- lavaan::fitMeasures(
    fit,
    c("chisq","df","pvalue","cfi","tli","rmsea",
      "rmsea.ci.lower","rmsea.ci.upper","srmr")
  )
  fit_table <- tibble::enframe(fm, name = "fit_index", value = "value")
  
  # --- Loadings and R²
  loadings <- lavaan::standardizedSolution(fit) |>
    dplyr::filter(op == "=~", lhs == "F", rhs %in% items) |>
    dplyr::transmute(item = rhs, std_loading = est.std)
  
  r2_tbl <- tibble::enframe(lavaan::lavInspect(fit, "r2"),
                            name = "item", value = "R2") |>
    dplyr::filter(item %in% items)
  
  diag <- dplyr::left_join(loadings, r2_tbl, by = "item") |>
    dplyr::mutate(
      flag_loading = std_loading < thresholds$min_std_loading,
      flag_r2      = R2 < thresholds$min_r2,
      flag_any     = flag_loading | flag_r2
    )
  
  list(
    call = match.call(),
    model_syntax = mod,
    fit = fit,
    fit_indices = fit_table,
    item_diagnostics = diag
  )
}

```

### Original 

#### Chocolate

```{r}

res <- cfa_constrained(data_exclusions, 
                       items = c(
                         "original_chocolate_like",
                         "original_chocolate_attention_capturing",
                         "original_chocolate_unusual",
                         "original_chocolate_figure_out",
                         "original_chocolate_positive",
                         "original_chocolate_fixtated",
                         "original_chocolate_look_away",
                         "original_chocolate_focused",
                         "original_chocolate_negative",
                         "original_chocolate_disgusting",
                         "original_chocolate_appealing",
                         "original_chocolate_eye_catching",
                         "original_chocolate_attractive",
                         "original_chocolate_avoid_looking"
                       ), 
                       ordered = FALSE)

# global fit
res$fit_indices |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

# item diagnostics (loadings, R2, max |std residual|, largest MI, and flags)
res$item_diagnostics |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

#### Poop

```{r}

res <- cfa_constrained(data_exclusions, 
                       items = c("original_poop_like",
                                 "original_poop_attention_capturing",
                                 "original_poop_unusual",
                                 "original_poop_figure_out",
                                 "original_poop_positive",
                                 "original_poop_fixtated",
                                 "original_poop_look_away",
                                 "original_poop_focused",
                                 "original_poop_negative",
                                 "original_poop_disgusting",
                                 "original_poop_appealing",
                                 "original_poop_eye_catching",
                                 "original_poop_attractive",
                                 "original_poop_avoid_looking"), 
                       ordered = FALSE)

# global fit
res$fit_indices |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

# item diagnostics (loadings, R2, max |std residual|, largest MI, and flags)
res$item_diagnostics |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

### Classic

#### Chocolate

```{r}

res <- cfa_constrained(
  data_exclusions, 
  items = c("classic_chocolate_pos_neg", 
            "classic_chocolate_pleasant_unpleasant", 
            "classic_chocolate_good_bad"), 
  ordered = FALSE
)

# global fit
res$fit_indices |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

# item diagnostics (loadings, R2, max |std residual|, largest MI, and flags)
res$item_diagnostics |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

#### Poop

```{r}

res <- cfa_constrained(
  data_exclusions, 
  items = c("classic_poop_pos_neg", 
            "classic_poop_pleasant_unpleasant", 
            "classic_poop_good_bad"), 
  ordered = FALSE
)

# global fit
res$fit_indices |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

# item diagnostics (loadings, R2, max |std residual|, largest MI, and flags)
res$item_diagnostics |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

## Reliability (Cronbach's alpha)

### Original items

#### Chocolate

```{r}

# data_exclusions |>
#   select(starts_with("original_chocolate_")) |>
#   cor() |>
#   round(2)

reliability_chocolate_original <- data_exclusions |>
  select(starts_with("original_chocolate_")) |>
  alpha()

reliability_chocolate_original$total$raw_alpha

```

#### Poop

```{r}

# data_exclusions |>
#   select(starts_with("original_poop_")) |>
#   cor() |>
#   round(2)

reliability_poop_original <- data_exclusions |>
  select(starts_with("original_poop_")) |>
  alpha()

reliability_poop_original$total$raw_alpha

```

### Classic preference items

#### Chocolate

```{r}

# data_exclusions |>
#   select(starts_with("classic_chocolate_")) |>
#   cor() |>
#   round(2)

reliability_chocolate_classic <- data_exclusions |>
  select(starts_with("classic_chocolate_")) |>
  alpha()

reliability_chocolate_classic$total$raw_alpha

```

#### Poop

```{r}

# data_exclusions |>
#   select(starts_with("classic_poop_")) |>
#   cor() |>
#   round(2)

reliability_poop_classic <- data_exclusions |>
  select(starts_with("classic_poop_")) |>
  alpha()

reliability_poop_classic$total$raw_alpha

```

## Convergent validity

### Chocolate

```{r fig.height=5, fig.width=5}

data_exclusions |>
  select(desirability_chocolate,
         classic_chocolate,
         original_chocolate) |>
  cor() |>
  round_half_up(2) 

ggplot(data_exclusions, aes(desirability_chocolate, classic_chocolate)) +
  geom_jitter(width = 0.1, height = 0.1, alpha = 0.3) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7) +
  scale_y_continuous(limits = c(0.5, 7.5), breaks = 1:7)

ggplot(data_exclusions, aes(desirability_chocolate, original_chocolate)) +
  geom_jitter(width = 0.1, height = 0.1, alpha = 0.3) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7) +
  scale_y_continuous(limits = c(0.5, 7.5), breaks = 1:7)

```

### Poop

```{r fig.height=5, fig.width=5}

data_exclusions |>
  select(desirability_poop,
         classic_poop,
         original_poop) |>
  cor() |>
  round_half_up(2) 

ggplot(data_exclusions, aes(desirability_poop, classic_poop)) +
  geom_jitter(width = 0.1, height = 0.1, alpha = 0.3) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7) +
  scale_y_continuous(limits = c(0.5, 7.5), breaks = 1:7)

ggplot(data_exclusions, aes(desirability_poop, original_poop)) +
  geom_jitter(width = 0.1, height = 0.1, alpha = 0.3) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7) +
  scale_y_continuous(limits = c(0.5, 7.5), breaks = 1:7)

```

## Standardized mean differences 

```{r fig.height=5, fig.width=9}

cohens_d_and_summaries <- function(data, var1, var2, mu = 4){
  data |>
    rename(var1 = {{var1}},
           var2 = {{var2}}) |>
    summarize(m1 = mean(var1),
              sd1 = sd(var1),
              n1 = n(), # assumes complete data
              m2 = mean(var2),
              sd2 = sd(var2),
              n2 = n(), # assumes complete data
              r = cor(var1, var2),
              d_s_onesample1 = cohens_d(var1, mu = mu)$Cohens_d,
              d_s_onesample2 = cohens_d(var2, mu = mu)$Cohens_d,
              d_av = repeated_measures_d(x = var1, 
                                         y = var2, 
                                         method = "av"),
              d_rm = repeated_measures_d(x = var1, 
                                         y = var2, 
                                         method = "rm"),
              d_z = repeated_measures_d(x = var1, 
                                         y = var2, 
                                         method = "z"),
              d_s = cohens_d(x = var1, 
                             y = var2)) |>
    unnest(d_av) |>
    select(-CI) |>
    rename(d_av__estimate = d_av,
           d_av__ci_lower = CI_low,
           d_av__ci_upper = CI_high) |>
    unnest(d_rm) |>
    select(-CI) |>
    rename(d_rm__estimate = d_rm,
           d_rm__ci_lower = CI_low,
           d_rm__ci_upper = CI_high) |>
    unnest(d_z) |>
    select(-CI) |>
    rename(d_z__estimate = d_z,
           d_z__ci_lower = CI_low,
           d_z__ci_upper = CI_high) |>
    unnest(d_s) |>
    select(-CI) |>
    rename(d_s__estimate = Cohens_d,
           d_s__ci_lower = CI_low,
           d_s__ci_upper = CI_high) |>
    mutate(var1 = rlang::as_name(ensym(var1)),
           var2 = rlang::as_name(ensym(var2))) |>
    relocate(var2) |>
    relocate(var1)
}

res <- bind_rows(
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate, var2 = original_poop),
  cohens_d_and_summaries(data = data_exclusions, var1 = classic_chocolate, var2 = classic_poop),
  cohens_d_and_summaries(data = data_exclusions, var1 = classic_chocolate_pos_neg, var2 = classic_poop_pos_neg),
  cohens_d_and_summaries(data = data_exclusions, var1 = classic_chocolate_pleasant_unpleasant, var2 = classic_poop_pleasant_unpleasant),
  cohens_d_and_summaries(data = data_exclusions, var1 = classic_chocolate_good_bad, var2 = classic_poop_good_bad),
  cohens_d_and_summaries(data = data_exclusions, var1 = desirability_chocolate, var2 = desirability_poop),
  cohens_d_and_summaries(data = data_exclusions, var1 = love, var2 = murder),
  cohens_d_and_summaries(data = data_exclusions, var1 = honest, var2 = dishonest),
  cohens_d_and_summaries(data = data_exclusions, var1 = vacation, var2 = racist),
  cohens_d_and_summaries(data = data_exclusions, var1 = liberals, var2 = conservatives),
  cohens_d_and_summaries(data = data_exclusions, var1 = mcdonalds, var2 = burgerking),
  cohens_d_and_summaries(data = data_exclusions, var1 = girls_skirts, var2 = boys_skirts),
  cohens_d_and_summaries(data = data_exclusions, var1 = cats_legs, var2 = fish_legs),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_like, var2 = original_poop_like),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_attention_capturing, var2 = original_poop_attention_capturing),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_unusual, var2 = original_poop_unusual),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_figure_out, var2 = original_poop_figure_out),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_positive, var2 = original_poop_positive),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_fixtated, var2 = original_poop_fixtated),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_look_away, var2 = original_poop_look_away),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_focused, var2 = original_poop_focused),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_negative, var2 = original_poop_negative),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_disgusting, var2 = original_poop_disgusting),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_appealing, var2 = original_poop_appealing),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_eye_catching, var2 = original_poop_eye_catching),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_attractive, var2 = original_poop_attractive),
  cohens_d_and_summaries(data = data_exclusions, var1 = original_chocolate_avoid_looking, var2 = original_poop_avoid_looking),
)

res |>
  mutate_if(is.numeric, round_half_up, digits = 2)

res_long <- res |>
  select(var1, var2, starts_with("d_") & !contains("sample")) |>
  pivot_longer(cols = starts_with("d_"),
               names_to = c("type", "parameter"),
               names_sep = "__",
               values_to = "value") |>
  pivot_wider(names_from = parameter,
              values_from = value) |>
  mutate(comparison = paste(var1, var2)) |>
  mutate(comparison = case_when(comparison == "original_chocolate original_poop" ~ "chocolate-poop original",
                                comparison == "classic_chocolate classic_poop" ~ "chocolate-poop classic",
                                comparison == "classic_chocolate_pos_neg classic_poop_pos_neg" ~ "chocolate-poop pos-neg",
                                comparison == "classic_chocolate_pleasant_unpleasant classic_poop_pleasant_unpleasant" ~ "chocolate-poop pleasant-unpleasant",
                                comparison == "classic_chocolate_good_bad classic_poop_good_bad" ~ "chocolate-poop good-bad",
                                comparison == "desirability_chocolate desirability_poop" ~ "chocolate-poop desirability",
                                comparison == "cats_legs fish_legs" ~ "cats/fish have four legs",
                                comparison == "girls_skirts boys_skirts" ~ "girls/boys tend to wear skirts",
                                TRUE ~ comparison)) |>
    mutate(comparison = fct_reorder(comparison, estimate)) 

res_long

ggplot(res_long, aes(estimate, comparison, color = type)) +
  geom_linerangeh(aes(xmin = ci_lower, xmax = ci_upper), 
                  position = position_dodge(width = 0.8)) +
  geom_point(position = position_dodge(width = 0.8)) +
  scale_x_continuous(name = "Cohen's d", breaks = breaks_pretty(n = 6)) +
  ylab("") +
  theme_linedraw() +
  guides(color = guide_legend(reverse = TRUE)) 

res_long_subset <- res_long |> 
  filter(comparison %in% c("love murder", 
                           "honest dishonest",
                           "chocolate-poop original",
                           "chocolate-poop classic",
                           "chocolate-poop pos-neg",
                           "chocolate-poop pleasant-unpleasant",
                           "chocolate-poop good-bad",
                           "cats/fish have four legs",
                           "girls/boys tend to wear skirts",
                           "chocolate-poop desirability")) |>
  filter(type == "d_av") 

res_long_subset |>
  mutate_if(is.numeric, round_half_up, digits = 2)

res_long_subset |>
  ggplot(aes(estimate, comparison)) +
  geom_linerangeh(aes(xmin = ci_lower, xmax = ci_upper)) +
  geom_point() +
  scale_x_continuous(name = "Cohen's d", breaks = breaks_pretty(n = 6)) +
  ylab("") +
  theme_linedraw() 



res_long_subset_chocpoop <- res_long |> 
  filter(comparison %in% c("chocolate-poop original",
                           "chocolate-poop classic",
                           "chocolate-poop pos-neg",
                           "chocolate-poop pleasant-unpleasant",
                           "chocolate-poop good-bad",
                           "chocolate-poop desirability"))

ggplot(res_long_subset_chocpoop, aes(estimate, comparison, color = type)) +
  geom_linerangeh(aes(xmin = ci_lower, xmax = ci_upper), position = position_dodge(width = 0.7)) +
  geom_point(position = position_dodge(width = 0.7)) +
  scale_x_continuous(name = "Cohen's d", breaks = breaks_pretty(n = 6)) +
  ylab("Outcome") +
  theme_linedraw() +
  guides(color = guide_legend(reverse = TRUE)) 

res_long_subset_chocpoop2 <- res_long |> 
  filter(comparison %in% c(
    "chocolate-poop original",
    "chocolate-poop classic",
    "chocolate-poop pos-neg",
    "chocolate-poop pleasant-unpleasant",
    "chocolate-poop good-bad",
    "chocolate-poop desirability",
    "original_chocolate_like original_poop_like",
    #"original_chocolate_attention_capturing original_poop_attention_capturing",
    #"original_chocolate_unusual original_poop_unusual",
    #"original_chocolate_figure_out original_poop_figure_out",
    "original_chocolate_positive original_poop_positive",
    #"original_chocolate_fixtated original_poop_fixtated",
    "original_chocolate_look_away original_poop_look_away",
    #"original_chocolate_focused original_poop_focused",
    "original_chocolate_negative original_poop_negative",
    "original_chocolate_disgusting original_poop_disgusting",
    #"original_chocolate_appealing original_poop_appealing",
    #"original_chocolate_eye_catching original_poop_eye_catching",
    #"original_chocolate_attractive original_poop_attractive",
    "original_chocolate_avoid_looking original_poop_avoid_looking"
  )) |>
  filter(type == "d_av")

ggplot(res_long_subset_chocpoop2, aes(estimate, comparison)) +
  geom_linerangeh(aes(xmin = ci_lower, xmax = ci_upper), position = position_dodge(width = 0.7)) +
  geom_point(position = position_dodge(width = 0.7)) +
  scale_x_continuous(name = "Cohen's d", breaks = breaks_pretty(n = 6)) +
  ylab("Outcome") +
  theme_linedraw() +
  guides(color = guide_legend(reverse = TRUE)) 

```

### Predicted vs observed

Researchers' predictions about the Cohen's d_av between the single item desirability items.

```{r}

data_predictions |>
  arrange(predicted_d) |>
  kable() |>
  kable_classic(full_width = FALSE)

data_predictions |>
  count()

ggplot(data_predictions, aes(predicted_d)) +
  geom_histogram(boundary = 0.5, binwidth = 1) +
  scale_x_continuous(breaks = 1:9, name = "Predicted Cohen's d_av") +
  ylab("Frequency") +
  geom_vline(xintercept = res$d_rm, linetype = "dashed", color = "red") +
  theme_linedraw()

```

# Other items

## Using attention checks as a comparison

Retaining all exclusion criteria other than the attention checks 

```{r}

data_exclusions_partial <- data_processed |>
  filter(self_exclude == "passed" &
           bot_check == "passed" & 
           age_check == "passed" & 
           completeness_check == "passed" &
           completion_time_check == "passed")

repeated_measures_d(x = data_exclusions_partial$attention_check2_numeric,
                    y = data_exclusions_partial$attention_check1_numeric,
                    method = "av") |>
  select(-CI) |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

```{r}

data_exclusions_partial |>
  summarize(mean_respondwith1 = mean(attention_check1_numeric),
            sd_respondwith1 = sd(attention_check1_numeric),
            mean_respondwith7 = mean(attention_check2_numeric),
            sd_respondwith7 = sd(attention_check2_numeric)) |>
  pivot_longer(cols = everything()) |>
  mutate(value = round_half_up(value, 2))

ggplot(data_exclusions_partial, aes(attention_check1_numeric)) +
  geom_histogram(boundary = 0.5, binwidth = 1) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7)

ggplot(data_exclusions_partial, aes(attention_check2_numeric)) +
  geom_histogram(boundary = 0.5, binwidth = 1) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7)

```



# Others

## Distributions

```{r}

data_exclusions_reshaped_2 <- data_exclusions |>
  select(participant_id, 
         girls_skirts,
         boys_skirts,
         cats_legs,
         fish_legs,
         vacation,
         pedophile,
         love,
         murder,
         honest,
         dishonest,
         racist,
         shrewd,
         mcdonalds,
         burgerking,
         liberals,
         conservatives) |>
  pivot_longer(cols = -participant_id,
               names_to = "stimulus",
               values_to = "response") |>
  mutate(stimulus = fct_relevel(stimulus,
                                "girls_skirts",
                                "boys_skirts",
                                "cats_legs",
                                "fish_legs",
                                "vacation",
                                "pedophile",
                                "love",
                                "murder",
                                "honest",
                                "dishonest",
                                "racist",
                                "shrewd",
                                "mcdonalds",
                                "burgerking",
                                "liberals",
                                "conservatives"))

ggplot(data_exclusions_reshaped_2, aes(response)) +
  geom_histogram(boundary = 0.5, binwidth = 1) +
  scale_x_continuous(limits = c(0.5, 7.5), breaks = 1:7) +
  theme_linedraw() +
  facet_wrap( ~ stimulus)

data_exclusions_reshaped_2 |>
  group_by(stimulus) |>
  summarize(mean = mean(response),
            sd = sd(response)) |>
  mutate_if(is.numeric, round_half_up, digits = 2) |>
  kable() |>
  kable_classic(full_width = FALSE)

```

# Session info

```{r}

sessionInfo()

```

